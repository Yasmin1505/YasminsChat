"use strict";var MessageItem=React.createClass({displayName:"MessageItem",render:function(){var e="messageItem",s="client"===this.props.source?"clientUserName":"serverUserName";"client"===this.props.source?"clientMessage":"serverMessage";return React.createElement("div",null,React.createElement("div",{className:e},React.createElement("div",{className:s},this.props.user_name)))}}),UserList=React.createClass({displayName:"UserList",render:function(){for(var e=[],s=0;s<this.props.users.length;s++)e.push(React.createElement("div",{key:s,className:"userItem"},this.props.users[s]));return React.createElement("div",{style:"overflow:scroll; display:block; float:left; padding:2px;"},React.createElement("h4",null,"Participants"),e)}}),ChatWindow=React.createClass({displayName:"ChatWindow",sendMsg:function(){var e=$(ReactDOM.findDOMNode(this)).find("input[data-messages]"),s=e.val();this.props.sendmsg(s),e.val("")},componentDidUpdate:function(){var e=$(ReactDOM.findDOMNode(this)).find("div[data-messages]");e.length&&(e[0].scrollTop=e[0].scrollHeight)},render:function(){var e,s=[],t=0;if(this.props.messages.length)for(t;t<this.props.messages.length;t++)e=this.props.messages[t].sender_Id,s.push(React.createElement(MessageItem,{username:this.props.messages[t].User.user_name,datetime:this.props.messages[t].timestamp,source:e===this.props.sender_Id?"client":"server",text:this.props.messages[t].msg_txt,key:this.props.messages[t].msg_Id}));return React.createElement("div",null,React.createElement("div",{style:"overflow:scroll;"},React.createElement("div",{className:"messagesDiv"},s)))}}),YasminsChatRoom=React.createClass({displayName:"YasminsChatRoom",getInitialState:function(){return{ChatHub:$.connection.YasminsHub,Messages:[],UserInitialized:!1,UserName:"",UserId:1,Users:[]}},pushPrevMsgsList:function(e){for(var s=this.state.Messages,t=0;t<e.length;t++)s.push({Id:e[t].msg_Id,UserId:e[t].sender_Id,UserName:msgLst[t].User.user_name,Message:e[t].msg_txt,DateTime:e[t].timestamp});this.setState({Messages:s})},pushNewMessage:function(e,s,t,a,r){var n=this.state.Messages;n.push({Id:e,UserId:s,UserName:t,Message:a,DateTime:r}),this.setState({Messages:n})},pushUserList:function(e){this.setState({Users:e})},componentWillMount:function(){this.state.ChatHub.client.pushPrevMsgsList=this.pushPrevMsgsList,this.state.ChatHub.client.pushNewMessage=this.pushNewMessage,this.state.ChatHub.client.pushUserList=this.pushUserList,$.connection.hub.start().done(function(){console.log("SignalR Hub Started!")})},sendMsg:function(e){var s={Id:e.msg_Id,UserId:e.sender_Id,UserName:e.User.user_name,Message:e.msg_txt,DateTime:new Date};$.ajax({method:"post",url:"./Chat/SaveAndPostChat/",data:JSON.stringify(s),dataType:"json",contentType:"application/json; charset=utf-8"})},render:function(){var e=this;return $.getJSON("./Chat/GetNewUserId").then(function(s){e.setState({UserInitialized:!0,UserName:{user_name:user_name},UserId:{user_Id:user_Id}})}),this.state.UserInitialized?React.createElement(ChatWindow,{messages:this.state.Messages,username:this.state.UserName,userid:this.state.UserId,sendmessage:this.sendMsg,users:this.state.Users}):React.createElement("div",null,React.createElement("h4",null,"something is wrong- go back to Submit ")," ")}});ReactDOM.render(React.createElement(YasminsChatRoom,null),document.getElementById("container"));